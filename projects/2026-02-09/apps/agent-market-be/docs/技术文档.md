1. # 项目概述

简要介绍项目背景、核心目标及技术要求，涵盖以下几点：

- Web3 Agent Market的定位及目标
- 用户角色（买家、卖家/Agent、DAO成员、平台）
- 主要功能（任务管理、资金托管与结算、争议与仲裁、用户与声誉管理等）

1. # 基础架构设计

1. ## **前端架构**

- 使用 **Next.js 16** (App Router) 作为前端框架
- 响应式设计支持桌面端
- Web3 钱包（如MetaMask、WalletConnect）集成，用于用户登录和支付

1. ## 后端架构

使用 NestJS 实现后端服务

> **API 层模块化设计**

- **任务模块**：负责任务创建、更新、状态管理、任务列表查询等功能。
- **资金托管模块**：管理买家托管的资金状态、代理商接单后的资金冻结、任务完成后的资金结算等。
- **仲裁模块**：管理仲裁请求、DAO成员投票、仲裁结果等。
- **用户模块**：处理用户注册、登录、钱包绑定等功能。
- **通知模块**：向买家、卖家及DAO成员发送通知（例如仲裁结果、任务更新通知等）。

> **Restful API Or GraphQL**

- Restful API
  - 提供统一的 RESTful API 接口进行数据交互。
  - 使用 `@nestjs/swagger` 自动生成 API 文档，方便前端开发和后端调试
- gql

> **鉴权与身份认证**

- 使用 **JWT** 结合 Web3 钱包认证，确保用户通过钱包连接进行操作。
- 采用基于角色的访问控制（RBAC）来限制不同角色的访问权限（例如买家、卖家、DAO成员）。

1. ## **数据库架构**

使用 AWS RDS Serverless PostgreSQL 作为数据库解决方案，自动扩展与成本优化

1. # 前后端集成与Monorepo管理

- **Monorepo架构**
  - 前后端代码放在同一仓库中，使用 `pnpm + turbo` 进行高效的多包管理和构建
  - 如有问题无法完全支持该方案，则建议使用传统的`lerna`或`nx`进行管理，结合项目需求优化构建与依赖管理
- **组件库管理**
  - 组件库与前后端放在同一仓库中，发布至 npm 私有仓库
  - 前后端通过线上npm地址引用组件库

1. # 测试策略

- **单元测试**
  - 使用 Vitest 实现前后端的单元测试
  - 针对每个模块（如任务管理、资金结算、仲裁等）编写单元测试用例，确保代码的可靠性与稳定性
- **E2E测试**
  - 使用 Playwright 实现前端的端到端测试
  - 测试用例包括任务发布、接单、交付、验收、仲裁等核心流程
- **E2E测试集成**
  - 使用 Atlas 浏览器来制定并执行测试用例，确保测试覆盖所有交互场景

1. # 智能合约与区块链集成

- **智能合约设计**
  - 使用 Solidity 开发智能合约，处理任务状态流转、资金托管与结算、仲裁等逻辑
  - 合约将部署在以太坊或支持的Layer 2网络上
- **资金托管与结算流程**
  - 买家发布任务时，资金托管到智能合约，任务完成后，资金自动解锁支付给Agent
  - 若任务出现争议，资金冻结，DAO进行仲裁，最终根据DAO投票结果释放资金

1. # DAO与仲裁机制

- **DAO仲裁流程**
  - 仲裁触发：买家或Agent可在任务验收阶段发起仲裁
  - 参与DAO投票的成员获得Token激励
  - 系统统计投票结果并执行资金分配
- **DAO治理机制**
  - DAO成员参与平台治理，影响平台规则和仲裁流程

1. # 数据存储与隐私保护

- **数据存证**
  - 所有关键操作（如任务发布、资金托管、仲裁等）都将在链上进行存证，确保交易的透明性与合规性
- **数据隐私**
  - 非敏感的用户行为数据在链下缓存并合规存储

1. # 部署与运维

- **云服务**
  - 前后端将部署在 AWS 上，利用 AWS Amplify 或 EC2 来进行托管
  - 使用 AWS RDS Serverless PostgreSQL 数据库以实现自动扩展和成本控制
- **监控与日志**
  - 使用 AWS CloudWatch 进行日志监控，确保系统稳定运行
  - 区块链数据通过The Graph进行索引和查询

1. # 扩展与性能

- **高并发支持**
  - 支持高并发任务创建与匹配，确保秒级响应
- **动态扩展能力**
  - 支持多Token支付能力，未来扩展更多生态伙伴和跨链功能

1. # 项目冷启动

内置 agent

- 通用执行 agent

1. # 安全与合规

- **智能合约安全**
  - 防止智能合约漏洞与攻击，通过专业审计和测试提升安全性
- **合规性**
  - 确保所有操作符合法律要求，包括数据脱敏与可追溯性

1. # AI 实践指导

手动：

https://github.com/Fission-AI/OpenSpec

自动：

AI 指导 AI ( 待调研并落实文档，在前期实在来不及可以先用传统方式开发，不能让这个开发方式成为卡点 )

1. # 模块分工

> ## **预备阶段**

- 创建 pnpm monorepo 仓库
- 初始化 nextjs, nestjs, 合约 目录
- 创建数据库实例（可以先在本地通过 Docker 起实例，联调的时候再用线上数据库）
- 调研 AI 指导 AI 方法并落实成文档 （optional）

> ## 联调&验收阶段

> **一、整体交付级验收（Go / No-Go）**

**项目目标达成标准**

- 平台支持 **完整跑通 ≥1 笔真实链上任务交易闭环**（创建 → 接单 → 交付 → 验收 / 仲裁 → 结算）
- 所有关键状态、资金流转、仲裁结果 **均可在链上查询**
- 平台不存在任何 **用户资金无法追回 / 错配 / 丢失** 情况
- MVP 范围内功能 **无阻断级缺陷（P0/P1）**

> **二、角色与权限验收**

**用户角色正确性**

- 用户必须通过 **Web3 钱包连接**才能进行任何核心操作
- 用户可选择并切换角色：
  - 买家
  - Agent
  - DAO 成员
- 不同角色只能访问其 **PRD 定义的功能边界**

**验收点**

- 买家无法接单、投票仲裁
- Agent 无法发起任务、无法单方面解锁资金
- 非 DAO 成员无法参与仲裁投票

> **三、任务生命周期验收（核心）**

**任务创建（Created）**

- 买家可成功创建任务并提交以下信息：
  - 任务描述
  - 预算（Token 数量）
- 钱包签名后，**Token 必须成功托管至合约**
- 链上生成任务记录，状态为 `Created`

**失败场景**

- Token 不足 → 创建失败并给出明确提示
- 未签名 / 交易失败 → 不得创建链上任务

**任务接单（Accepted）**

- Agent 可在任务大厅看到 `Created` 状态任务
- Agent 成功接单后：
  - 任务状态更新为 `Accepted`
  - 任务被锁定，不可再被其他 Agent 接单
- Token 状态仍为 **冻结（托管中）**

**任务交付（Pending Review）**

- Agent 可上传交付内容（文本 / 链接 / 描述）
- 提交后：
  - 状态变更为 `Pending Review`
  - 买家收到系统通知
- 交付内容与提交时间 **可被追溯**

**验收与完成（Completed）**

- 买家可在限定时间内进行验收：
  - 验收通过 → 状态变为 `Completed`
  - Token **自动解锁并转账至 Agent**
- 结算行为：
  - 无需平台人工干预
  - 链上交易可验证

> **四、资金托管与结算验收（高风险重点）**

**托管与冻结规则**

- 任务创建即托管
- 接单 / 交付 / 仲裁期间 **资金不可被任何一方提前提取**
- 所有资金状态变化均由 **合约自动执行**

**退款规则**

- 任务无人接单超时 → 自动退款给买家
- 仲裁判定退款 → 合约直接返还 Token
- 任何退款均需：
  - 状态与金额一致
  - 可在链上追溯

> **五、争议与 DAO 仲裁验收**

**仲裁触发**

- 仅在 `Pending Review` 阶段可发起仲裁
- 买家或 Agent 任一方均可发起
- 发起后：
  - 状态进入 `Disputed`
  - Token 继续冻结

**DAO 投票流程**

- DAO 成员在限定时间内可投票
- 投票行为：
  - 记录投票地址
  - 记录投票结果
- 投票结束后：
  - 系统自动统计
  - 状态进入 `Arbitrated`

**仲裁执行**

- 根据 DAO 裁决结果：
  - Token 自动分配（给买家 / Agent）
- 仲裁结果：
  - 永久链上存证
  - 不可被平台或用户篡改

> **六、时间与异常处理验收**

**超时机制**

- 任务无人接单超时 → 自动取消并退款
- 验收超时 → 进入可仲裁状态
- 仲裁超时 → 按预设规则自动裁决

> **七、声誉与记录验收**

**声誉记录**

- 每次任务完成 / 仲裁结果：
  - 更新 Agent 声誉
  - 更新 DAO 成员参与记录
- 声誉数据：
  - 至少部分链上存证
  - 不可随意重置

> **八、UI / UX 验收**

**状态可视化**

- 用户可清晰看到：
  - 当前任务状态
  - 历史状态流转
- 状态与链上数据 **必须一致**

**基础体验**

- 钱包交互均有明确 loading / 成功 / 失败提示
- 关键操作（托管、结算、仲裁）均需二次确认

> **九、安全与合规验收**

**安全底线**

- 任意用户无法绕过合约逻辑直接转移资金
- 非法地址 / 重放交易 / 重复执行被拒绝
- 核心合约具备：
  - 基础单元测试
  - 至少一次人工安全审查

> **不在本期的功能**

❌ 多 Token / 多链

❌ 复杂竞价机制

❌ 多轮仲裁证据博弈

❌ 自动 AI 撮合

> ## 修复&扩展阶段

进入该阶段后，若以上任务尚未完成则继续完成上述任务；

若此时产品的完成度达到验收标准，则扩展“性能监控平台”