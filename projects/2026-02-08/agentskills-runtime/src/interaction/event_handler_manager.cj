
/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2024-2025. All rights reserved.
 */
//-----------------------------------------------
// This file is generated by gen.py
// Never modify it directly
//-----------------------------------------------
package magic.interaction

import magic.core.interaction.*
import magic.core.agent.{Agent, AgentRequest, AgentResponse}
import magic.core.tool.{ToolRequest, ToolResponse}
import magic.core.model.{ChatRequest, ChatResponse}
import magic.utils.randomString

import std.collection.ArrayList

public type ToolCallStartEventHandler = (ToolCallStartEvent) -> EventResponse<ToolResponse>
public type ToolCallEndEventHandler = (ToolCallEndEvent) -> Unit
public type ToolCallRepeatEventHandler = (ToolCallRepeatEvent) -> EventResponse<ToolResponse>
public type ChatModelStartEventHandler = (ChatModelStartEvent) -> EventResponse<ChatResponse>
public type ChatModelEndEventHandler = (ChatModelEndEvent) -> Unit
public type ChatModelFailureEventHandler = (ChatModelFailureEvent) -> EventResponse<ChatResponse>
public type AgentStartEventHandler = (AgentStartEvent) -> EventResponse<AgentResponse>
public type AgentEndEventHandler = (AgentEndEvent) -> Unit
public type AgentStepEventHandler = (AgentStepEvent) -> Unit
public type SubAgentStartEventHandler = (SubAgentStartEvent) -> EventResponse<AgentResponse>
public type SubAgentEndEventHandler = (SubAgentEndEvent) -> Unit
public type AgentTimeoutEventHandler = (AgentTimeoutEvent) -> Unit
public type UserInputEventHandler = (UserInputEvent) -> EventResponse<String>
public type NotifyEventHandler = (NotifyEvent) -> Unit

public class EventHandlerManager {
    protected static let CLASS_NAME = "event-handler-manager"

    public EventHandlerManager(
        private let name!: String = randomString(size: 8)
    ) { }

    private static var _global: Option<EventHandlerManager> = None
    public static prop global: EventHandlerManager {
        get() {
            if (let Some(v) <- _global) {
                return v
            } else {
                let v = EventHandlerManager(name: "Global event manager")
                _global = v
                return v
            }
        }
    }



    // Handler for ToolCallStartEvent events
    private let toolCallStartEventHandlers = ArrayList<ToolCallStartEventHandler>()

    // Add addHandler method
    public func addHandler(handler: ToolCallStartEventHandler): Unit {
        this.toolCallStartEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: ToolCallStartEvent): EventResponse<ToolResponse> {
        for (handler in this.toolCallStartEventHandlers) {
           match (handler(evt)) {
               case Continue => ()
               case Continue(v) => return Continue(v)
               case Terminate(v) => return Terminate(v)
           }
       }
       return Continue
    }


    // Handler for ToolCallEndEvent events
    private let toolCallEndEventHandlers = ArrayList<ToolCallEndEventHandler>()

    // Add addHandler method
    public func addHandler(handler: ToolCallEndEventHandler): Unit {
        this.toolCallEndEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: ToolCallEndEvent): Unit {
        for (handler in this.toolCallEndEventHandlers) {
           handler(evt)
       }
    }


    // Handler for ToolCallRepeatEvent events
    private let toolCallRepeatEventHandlers = ArrayList<ToolCallRepeatEventHandler>()

    // Add addHandler method
    public func addHandler(handler: ToolCallRepeatEventHandler): Unit {
        this.toolCallRepeatEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: ToolCallRepeatEvent): EventResponse<ToolResponse> {
        for (handler in this.toolCallRepeatEventHandlers) {
           match (handler(evt)) {
               case Continue => ()
               case Continue(v) => return Continue(v)
               case Terminate(v) => return Terminate(v)
           }
       }
       return Continue
    }


    // Handler for ChatModelStartEvent events
    private let chatModelStartEventHandlers = ArrayList<ChatModelStartEventHandler>()

    // Add addHandler method
    public func addHandler(handler: ChatModelStartEventHandler): Unit {
        this.chatModelStartEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: ChatModelStartEvent): EventResponse<ChatResponse> {
        for (handler in this.chatModelStartEventHandlers) {
           match (handler(evt)) {
               case Continue => ()
               case Continue(v) => return Continue(v)
               case Terminate(v) => return Terminate(v)
           }
       }
       return Continue
    }


    // Handler for ChatModelEndEvent events
    private let chatModelEndEventHandlers = ArrayList<ChatModelEndEventHandler>()

    // Add addHandler method
    public func addHandler(handler: ChatModelEndEventHandler): Unit {
        this.chatModelEndEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: ChatModelEndEvent): Unit {
        for (handler in this.chatModelEndEventHandlers) {
           handler(evt)
       }
    }


    // Handler for ChatModelFailureEvent events
    private let chatModelFailureEventHandlers = ArrayList<ChatModelFailureEventHandler>()

    // Add addHandler method
    public func addHandler(handler: ChatModelFailureEventHandler): Unit {
        this.chatModelFailureEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: ChatModelFailureEvent): EventResponse<ChatResponse> {
        for (handler in this.chatModelFailureEventHandlers) {
           match (handler(evt)) {
               case Continue => ()
               case Continue(v) => return Continue(v)
               case Terminate(v) => return Terminate(v)
           }
       }
       return Continue
    }


    // Handler for AgentStartEvent events
    private let agentStartEventHandlers = ArrayList<AgentStartEventHandler>()

    // Add addHandler method
    public func addHandler(handler: AgentStartEventHandler): Unit {
        this.agentStartEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: AgentStartEvent): EventResponse<AgentResponse> {
        for (handler in this.agentStartEventHandlers) {
           match (handler(evt)) {
               case Continue => ()
               case Continue(v) => return Continue(v)
               case Terminate(v) => return Terminate(v)
           }
       }
       return Continue
    }


    // Handler for AgentEndEvent events
    private let agentEndEventHandlers = ArrayList<AgentEndEventHandler>()

    // Add addHandler method
    public func addHandler(handler: AgentEndEventHandler): Unit {
        this.agentEndEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: AgentEndEvent): Unit {
        for (handler in this.agentEndEventHandlers) {
           handler(evt)
       }
    }


    // Handler for AgentStepEvent events
    private let agentStepEventHandlers = ArrayList<AgentStepEventHandler>()

    // Add addHandler method
    public func addHandler(handler: AgentStepEventHandler): Unit {
        this.agentStepEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: AgentStepEvent): Unit {
        for (handler in this.agentStepEventHandlers) {
           handler(evt)
       }
    }


    // Handler for SubAgentStartEvent events
    private let subAgentStartEventHandlers = ArrayList<SubAgentStartEventHandler>()

    // Add addHandler method
    public func addHandler(handler: SubAgentStartEventHandler): Unit {
        this.subAgentStartEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: SubAgentStartEvent): EventResponse<AgentResponse> {
        for (handler in this.subAgentStartEventHandlers) {
           match (handler(evt)) {
               case Continue => ()
               case Continue(v) => return Continue(v)
               case Terminate(v) => return Terminate(v)
           }
       }
       return Continue
    }


    // Handler for SubAgentEndEvent events
    private let subAgentEndEventHandlers = ArrayList<SubAgentEndEventHandler>()

    // Add addHandler method
    public func addHandler(handler: SubAgentEndEventHandler): Unit {
        this.subAgentEndEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: SubAgentEndEvent): Unit {
        for (handler in this.subAgentEndEventHandlers) {
           handler(evt)
       }
    }


    // Handler for AgentTimeoutEvent events
    private let agentTimeoutEventHandlers = ArrayList<AgentTimeoutEventHandler>()

    // Add addHandler method
    public func addHandler(handler: AgentTimeoutEventHandler): Unit {
        this.agentTimeoutEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: AgentTimeoutEvent): Unit {
        for (handler in this.agentTimeoutEventHandlers) {
           handler(evt)
       }
    }


    // Handler for UserInputEvent events
    private let userInputEventHandlers = ArrayList<UserInputEventHandler>()

    // Add addHandler method
    public func addHandler(handler: UserInputEventHandler): Unit {
        this.userInputEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: UserInputEvent): EventResponse<String> {
        for (handler in this.userInputEventHandlers) {
           match (handler(evt)) {
               case Continue => ()
               case Continue(v) => return Continue(v)
               case Terminate(v) => return Terminate(v)
           }
       }
       return Continue
    }


    // Handler for NotifyEvent events
    private let notifyEventHandlers = ArrayList<NotifyEventHandler>()

    // Add addHandler method
    public func addHandler(handler: NotifyEventHandler): Unit {
        this.notifyEventHandlers.add(handler)
    }

    // Add handle method
    protected func handle(evt: NotifyEvent): Unit {
        for (handler in this.notifyEventHandlers) {
           handler(evt)
       }
    }

    protected func merge(another: EventHandlerManager): Unit {
        this.toolCallStartEventHandlers.add(all: another.toolCallStartEventHandlers)
        this.toolCallEndEventHandlers.add(all: another.toolCallEndEventHandlers)
        this.toolCallRepeatEventHandlers.add(all: another.toolCallRepeatEventHandlers)
        this.chatModelStartEventHandlers.add(all: another.chatModelStartEventHandlers)
        this.chatModelEndEventHandlers.add(all: another.chatModelEndEventHandlers)
        this.chatModelFailureEventHandlers.add(all: another.chatModelFailureEventHandlers)
        this.agentStartEventHandlers.add(all: another.agentStartEventHandlers)
        this.agentEndEventHandlers.add(all: another.agentEndEventHandlers)
        this.agentStepEventHandlers.add(all: another.agentStepEventHandlers)
        this.subAgentStartEventHandlers.add(all: another.subAgentStartEventHandlers)
        this.subAgentEndEventHandlers.add(all: another.subAgentEndEventHandlers)
        this.agentTimeoutEventHandlers.add(all: another.agentTimeoutEventHandlers)
        this.userInputEventHandlers.add(all: another.userInputEventHandlers)
        this.notifyEventHandlers.add(all: another.notifyEventHandlers)
    }
}